interal refactoring to simplify scope node lookup